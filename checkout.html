<!DOCTYPE html>
<html lang="en">

<head>
    <!-- All previous head content remains the same until the script -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - JARVIS</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="icon" type="image/png" href="top.jpg">
    <style>
        /* Base Styles */
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        .btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: #ff6b6b;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            text-decoration: none;
            transition: background-color 0.3s;
        }

        .btn:hover {
            background-color: #ff5252;
        }

        /* Header Styles */
        header {
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .top-bar {
            padding: 15px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
        }

        .logo h1 {
            color: #ff6b6b;
            font-size: 28px;
            font-weight: 800;
        }

        .user-actions {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-left: auto;
        }

        .user-actions a {
            color: #333;
            text-decoration: none;
            font-weight: 500;
        }

        nav ul {
            display: flex;
            list-style: none;
            padding: 15px 0;
        }

        nav ul li {
            margin-right: 20px;
        }

        nav ul li a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
        }

        /* Checkout Styles */
        .checkout-container {
            display: flex;
            gap: 30px;
            margin: 40px 0;
            flex-wrap: wrap;
        }

        .checkout-form {
            flex: 2;
            min-width: 300px;
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05);
        }

        .order-summary {
            flex: 1;
            min-width: 300px;
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05);
            align-self: flex-start;
        }

        .checkout-section {
            margin-bottom: 30px;
        }

        .checkout-section h2 {
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
            font-size: 22px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        .row {
            display: flex;
            gap: 20px;
        }

        .row .form-group {
            flex: 1;
        }

        /* Payment Methods */
        .payment-method {
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            overflow: hidden;
        }

        .payment-method input[type="radio"] {
            display: none;
        }

        .payment-method label {
            display: block;
            padding: 15px;
            cursor: pointer;
            background: #f9f9f9;
            transition: all 0.3s;
        }

        .payment-method input[type="radio"]:checked+label {
            background: #fff8e1;
            border-left: 4px solid #ff6b6b;
        }

        .payment-method .payment-content {
            padding: 0 15px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s;
        }

        .payment-method input[type="radio"]:checked~.payment-content {
            max-height: 500px;
            padding: 15px;
        }

        .payment-icon {
            margin-right: 10px;
            font-size: 20px;
            vertical-align: middle;
        }

        /* Order Summary */
        .cart-item {
            display: flex;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
            gap: 15px;
        }

        .cart-item-image {
            width: 80px;
            height: 80px;
            object-fit: contain;
            border-radius: 4px;
        }

        .item-details {
            flex: 1;
        }

        .item-details h4 {
            margin-bottom: 5px;
            font-size: 16px;
        }

        .item-details .price {
            color: #ff6b6b;
            font-weight: 500;
        }

        .item-details .original-price {
            text-decoration: line-through;
            color: #999;
            font-size: 14px;
            margin-left: 5px;
        }

        .price-summary {
            margin: 20px 0;
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .total-row {
            font-weight: bold;
            font-size: 18px;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }

        .btn-checkout {
            width: 100%;
            padding: 15px;
            background-color: #ff6b6b;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .btn-checkout:hover {
            background-color: #ff5252;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .checkout-container {
                flex-direction: column;
            }

            .row {
                flex-direction: column;
                gap: 0;
            }
        }




        .address-selection {
            margin-bottom: 20px;
        }

        .address-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 15px;
        }

        .address-option {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .address-option:hover {
            border-color: #ff6b6b;
        }

        .address-option.selected {
            border-color: #ff6b6b;
            background-color: #fff5f5;
        }

        .address-option h4 {
            margin: 0 0 10px 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .default-badge {
            background-color: #ff6b6b;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
        }

        .use-new-address {
            margin-top: 15px;
        }

        .logo h1 {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Mobile User Actions */
        .user-actions .desktop-text {
            display: inline;
        }

        .user-actions .mobile-icon {
            display: none;
            font-size: 20px;
        }

        /* Mobile Menu Styles */
        .menu-toggle {
            display: none;
            cursor: pointer;
            padding: 10px;
        }

        .menu-toggle span {
            display: block;
            width: 25px;
            height: 3px;
            background-color: var(--secondary-color);
            margin: 5px 0;
            transition: all 0.3s ease;
        }

        .mobile-menu {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background-color: var(--white);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
            width: 200px;
            border-radius: 4px;
            overflow: hidden;
        }

        .mobile-menu.active {
            display: block;
        }

        .mobile-menu a {
            display: block;
            padding: 12px 20px;
            color: var(--secondary-color);
            text-decoration: none;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .mobile-menu a:hover {
            background-color: #f5f5f5;
            color: var(--primary-color);
        }

        /* Active nav state */
        nav ul li.active a {
            color: var(--primary-color);
            position: relative;
        }

        nav ul li.active a:after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: var(--primary-color);
        }

        /* Loading and error states */
        .loading,
        .no-products,
        .error,
        .empty-cart {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 18px;
            grid-column: 1 / -1;
        }

        /* Responsive User Actions */
        @media (max-width: 768px) {
            .user-actions .desktop-text {
                display: none;
            }

            .user-actions .mobile-icon {
                display: inline-block;
            }

            .user-actions a {
                padding: 8px;
                font-size: 18px;
            }

            .menu-toggle {
                display: block;
            }

            nav ul {
                display: none;
            }
        }

        @media (max-width: 768px) {
            nav .container {
                display: block !important;
                overflow-x: auto !important;
                white-space: nowrap !important;
                -webkit-overflow-scrolling: touch !important;
            }

            nav ul {
                display: flex !important;
                flex-wrap: nowrap !important;
                overflow-x: auto !important;
                padding-bottom: 10px !important;
            }

            nav ul li {
                margin-right: 30px !important;
                flex-shrink: 0 !important;
            }

            /* Hide mobile menu elements since we don't need them */
            .menu-toggle,
            .mobile-menu {
                display: none !important;
            }
        }
    </style>

    <!-- Add Firebase SDK -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
        import {
            getAuth,
            onAuthStateChanged
        } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
        import {
            getFirestore,
            collection,
            addDoc,
            doc,
            setDoc,
            updateDoc,
            arrayUnion,
            getDoc,
            query,
            where,
            getDocs,
            deleteDoc
        } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDqXN_NjP3OUGhd-ah-hWTO66REtlMqwAk",
            authDomain: "jarvis-e-commerce-a6563.firebaseapp.com",
            projectId: "jarvis-e-commerce-a6563",
            storageBucket: "jarvis-e-commerce-a6563.firebasestorage.app",
            messagingSenderId: "998302088355",
            appId: "1:998302088355:web:36279bf2694647baf05316",
            measurementId: "G-Q9E7Z27L6K"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Function to save order history
        async function saveOrderHistory(orderData) {
            try {
                const user = auth.currentUser;
                if (!user) {
                    console.error("No user logged in");
                    return false;
                }

                // Add order to the orders collection
                const orderRef = await addDoc(collection(db, "orders"), {
                    ...orderData,
                    userId: user.uid,
                    createdAt: new Date()
                });

                // Also add to user's order history
                await updateDoc(doc(db, "users", user.uid), {
                    orderHistory: arrayUnion(orderRef.id)
                });

                return orderRef.id; // Return the order ID
            } catch (error) {
                console.error("Error saving order history:", error);
                return false;
            }
        }

        // Function to save address to user's address book
        async function saveUserAddress(addressData) {
            try {
                const user = auth.currentUser;
                if (!user) {
                    console.error("No user logged in");
                    return false;
                }

                // Add address to user's address book
                await updateDoc(doc(db, "users", user.uid), {
                    addresses: arrayUnion(addressData)
                });

                return true;
            } catch (error) {
                console.error("Error saving address:", error);
                return false;
            }
        }

        // Function to get user's addresses
        async function getUserAddresses() {
            try {
                const user = auth.currentUser;
                if (!user) {
                    console.error("No user logged in");
                    return [];
                }

                const userDoc = await getDoc(doc(db, "users", user.uid));
                if (userDoc.exists()) {
                    return userDoc.data().addresses || [];
                }
                return [];
            } catch (error) {
                console.error("Error getting user addresses:", error);
                return [];
            }
        }

        // Make functions available globally
        window.saveOrderHistory = saveOrderHistory;
        window.saveUserAddress = saveUserAddress;
        window.getUserAddresses = getUserAddresses;
    </script>
</head>

<body>

    <header>
        <div class="top-bar">
            <div class="container">
                <div class="logo">
                    <h1><img src="logo.jpg" style="width: 50px; height: 50px; border-radius: 50%; object-fit: cover;"
                            alt="Jarvis Logo"> Jarvis</h1>
                </div>
                <div class="user-actions">
                    <a href="home.html">
                        <i class="fas fa-home mobile-icon"></i>
                        <span class="desktop-text">Home</span>
                    </a>

                    </a>
                    <a href="#" class="cart">
                        <i class="fas fa-shopping-cart mobile-icon"></i>
                        <span class="desktop-text">Cart</span>
                        <span id="cart-count">0</span>
                    </a>
                </div>
            </div>
        </div>
        <nav>
            <div class="container">
                <ul>
                    <li><a href="home.html">Home</a></li>
                    <!-- <li><a href="electronics.html">Electronics</a></li>
                    <li><a href="fashion.html">Fashion</a></li>
                    <li><a href="home-kitchen.html">Home & Kitchen</a></li>
                    <li><a href="beauty.html">Beauty</a></li>
                    <li><a href="groceries.html">Groceries</a></li>
                    <li><a href="offers.html">Offers</a></li> -->
                </ul>
            </div>
        </nav>
    </header>

    <main class="container">
        <div class="checkout-container">
            <div class="checkout-form">
                <div class="checkout-section">
                    <h2>Shipping Information</h2>

                    <!-- Address Selection -->
                    <div class="address-selection" id="address-selection" style="display: none;">
                        <h3>Select Delivery Address</h3>
                        <div class="address-options" id="address-options">
                            <!-- Address options will be populated here -->
                        </div>
                        <div class="use-new-address">
                            <button type="button" class="btn" id="use-new-address">Use New Address</button>
                        </div>
                    </div>


                    <form id="shipping-form">
                        <div class="row">
                            <div class="form-group">
                                <label for="first-name">First Name</label>
                                <input type="text" id="first-name" required>
                            </div>
                            <div class="form-group">
                                <label for="last-name">Last Name</label>
                                <input type="text" id="last-name" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="email">Email Address</label>
                            <input type="email" id="email" required>
                        </div>

                        <div class="form-group">
                            <label for="phone">Phone Number</label>
                            <input type="number" minlength="10" maxlength="10" id="phone" required>
                        </div>

                        <div class="form-group">
                            <label for="address">Street Address</label>
                            <input type="text" id="address" required>
                        </div>

                        <div class="row">
                            <div class="form-group">
                                <label for="city">City</label>
                                <input type="text" id="city" required>
                            </div>
                            <div class="form-group">
                                <label for="state">State</label>
                                <select id="state" required>
                                    <option value="">Select State</option>
                                    <option value="TN">Tamil Nadu</option>
                                    <option value="MH">Maharashtra</option>
                                    <option value="DL">Delhi</option>
                                    <option value="KA">Karnataka</option>
                                    <option value="Gujarat">Gujarat</option>
                                    <option value="Rajasthan">Rajasthan</option>
                                    <option value="Uttar Pradesh">Uttar Pradesh</option>
                                    <option value="West Bengal">West Bengal</option>
                                    <option value="Bihar">Bihar</option>
                                    <option value="Odisha">Odisha</option>
                                    <option value="Madhya Pradesh">Madhya Pradesh</option>
                                    <option value="Assam">Assam</option>
                                    <option value="Punjab">Punjab</option>
                                    <option value="Haryana">Haryana</option>
                                    <option value="Jharkhand">Jharkhand</option>
                                    <option value="Chhattisgarh">Chhattisgarh</option>
                                    <option value="Uttarakhand">Uttarakhand</option>
                                    <option value="Himachal Pradesh">Himachal Pradesh</option>
                                    <option value="Tripura">Tripura</option>
                                    <option value="Meghalaya">Meghalaya</option>
                                    <option value="Manipur">Manipur</option>
                                    <option value="Nagaland">Nagaland</option>
                                    <option value="Goa">Goa</option>
                                    <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                                    <option value="Mizoram">Mizoram</option>
                                    <option value="Sikkim">Sikkim</option>
                                    <option value="Telangana">Telangana</option>
                                </select>
                            </div>
                        </div>

                        <div class="row">
                            <div class="form-group">
                                <label for="zip">ZIP Code</label>
                                <input type="text" minlength="6" maxlength="6" id="zip" required>
                            </div>
                            <div class="form-group">
                                <label for="country">Country</label>
                                <select id="country" required>
                                    <option value="IN">India</option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>

                <div class="checkout-section">
                    <h2>Payment Method</h2>

                    <div class="payment-method">
                        <input type="radio" name="payment" id="credit-card" checked>
                        <label for="credit-card">
                            <i class="fas fa-credit-card payment-icon"></i>
                            Credit/Debit Card
                        </label>
                        <div class="payment-content">
                            <div class="form-group">
                                <label for="card-number">Card Number</label>
                                <input type="number" minlength="16" maxlength="16" id="card-number"
                                    placeholder="1234 5678 9012 3456">
                            </div>
                            <div class="row">
                                <div class="form-group">
                                    <label for="card-name">Name on Card</label>
                                    <input type="text" pattern="[A-Za-z ]+" title="Only alphabets allowed"
                                        id="card-name">
                                </div>
                                <div class="form-group">
                                    <label for="card-expiry">Expiry Date</label>
                                    <input type="number" id="card-expiry" minlength="4" maxlength="4"
                                        placeholder="MM/YY">
                                </div>
                                <div class="form-group">
                                    <label for="card-cvv">CVV</label>
                                    <input type="number" maxlength="3" id="card-cvv" placeholder="123">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="payment-method">
                        <input type="radio" name="payment" id="upi">
                        <label for="upi">
                            <i class="fas fa-mobile-alt payment-icon"></i>
                            UPI Payment
                        </label>
                        <div class="payment-content">
                            <div class="form-group">
                                <label for="upi-id">UPI ID</label>
                                <input type="text" id="upi-id" placeholder="yourname@upi">
                            </div>
                            <p>Pay using any UPI app like Google Pay, PhonePe, Paytm</p>
                        </div>
                    </div>

                    <div class="payment-method">
                        <input type="radio" name="payment" id="net-banking">
                        <label for="net-banking">
                            <i class="fas fa-university payment-icon"></i>
                            Net Banking
                        </label>
                        <div class="payment-content">
                            <div class="form-group">
                                <label for="bank">Select Bank</label>
                                <select id="bank">
                                    <option value="">Select your bank</option>
                                    <option value="SBI">State Bank of India</option>
                                    <option value="HDFC">HDFC Bank</option>
                                    <option value="ICICI">ICICI Bank</option>
                                    <option value="AXIS">Axis Bank</option>
                                    <option value="UNION">Union Bank</option>
                                    <option value="IOB">Indian overse Bank</option>
                                    <option value="TMB">TM Bank</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="payment-method">
                        <input type="radio" name="payment" id="wallet">
                        <label for="wallet">
                            <i class="fas fa-wallet payment-icon"></i>
                            Wallet
                        </label>
                        <div class="payment-content">
                            <div class="form-group">
                                <label>Select Wallet</label>
                                <div style="display: flex; gap: 10px; margin-top: 10px;">
                                    <label style="flex: 1; text-align: center; cursor: pointer;">
                                        <img src="Paytm.jpeg" alt="Paytm" style="max-width: 100%;">
                                        <input type="radio" name="wallet-type" style="display: none;">
                                    </label>
                                    <label style="flex: 1; text-align: center; cursor: pointer;">
                                        <img src="Phonepe.jpeg" alt="PhonePe" style="max-width: 100%;">
                                        <input type="radio" name="wallet-type" style="display: none;">
                                    </label>
                                    <label style="flex: 1; text-align: center; cursor: pointer;">
                                        <img src="Amazon pay.jpeg" alt="AmazonPay" style="max-width: 100%;">
                                        <input type="radio" name="wallet-type" style="display: none;">
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="payment-method">
                        <input type="radio" name="payment" id="cod">
                        <label for="cod">
                            <i class="fas fa-money-bill-wave payment-icon"></i>
                            Cash on Delivery
                        </label>
                        <div class="payment-content">
                            <p>Pay cash when your order is delivered</p>
                            <p><small>Extra ₹50 charge may apply</small></p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="order-summary">
                <h2>Order Summary (<span id="item-count">0</span> Items)</h2>

                <div id="cart-items-container">
                    <!-- Cart items will be loaded here from localStorage -->
                </div>

                <div class="price-summary">
                    <div class="price-row">
                        <span>Subtotal:</span>
                        <span id="subtotal">₹0</span>
                    </div>
                    <div class="price-row">
                        <span>Discount:</span>
                        <span id="discount">-₹0</span>
                    </div>
                    <div class="price-row">
                        <span>Tax(GST):</span>
                        <span id="tax">18%</span>
                    </div>
                    <div class="price-row">
                        <span>Shipping:</span>
                        <span id="shipping">FREE</span>
                    </div>
                    <div class="price-row total-row">
                        <span>Total:</span>
                        <span id="total">₹0</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="promo-code">Promo Code</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="promo-code" placeholder="Enter promo code" style="flex: 1;">
                        <button class="btn" style="padding: 0 15px;">Apply</button>
                    </div>
                </div>

                <button class="btn-checkout" id="place-order">Place Order</button>

                <div style="text-align: center; margin-top: 15px; color: #666;">
                    <i class="fas fa-lock"></i> Secure Checkout
                </div>
            </div>
        </div>
    </main>

    <footer style="background-color: #222; color: white; padding: 50px 0 0;">
        <div class="container">
            <div
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 30px; margin-bottom: 30px;">
                <div>
                    <h3 style="margin-bottom: 20px; font-size: 20px;">About Jarvis</h3>
                    <p style="margin-bottom: 15px; line-height: 1.6;">Jarvis is India's fastest growing e-commerce
                        platform, offering best prices and fastest delivery across the country.</p>
                </div>
                <div>
                    <h3 style="margin-bottom: 20px; font-size: 20px;">Quick Links</h3>
                    <ul style="list-style: none; margin-bottom: 15px; line-height: 1.6;">
                        <li><a href="home.html" style="color: #ddd; text-decoration: none;">Home</a></li>
                        <li><a href="about.html" style="color: #ddd; text-decoration: none;">About Us</a></li>
                        <li><a href="Customer.html" style="color: #ddd; text-decoration: none;">Contact</a></li>
                        <li><a href="privacy.html" style="color: #ddd; text-decoration: none;">Privacy Policy</a></li>
                        <li><a href="terms.html" style="color: #ddd; text-decoration: none;">Terms & Conditions</a></li>
                    </ul>
                </div>
                <div>
                    <h3 style="margin-bottom: 20px; font-size: 20px;">Contact Us</h3>
                    <p style="margin-bottom: 15px; line-height: 1.6;"><i class="fas fa-map-marker-alt"
                            style="margin-right: 10px; color: #ff6b6b;"></i> 123 TPT, Tamilnadu, India</p>
                    <p style="margin-bottom: 15px; line-height: 1.6;"><i class="fas fa-phone"
                            style="margin-right: 10px; color: #ff6b6b;"></i> +91 6383221055</p>
                    <p style="margin-bottom: 15px; line-height: 1.6;"><i class="fas fa-envelope"
                            style="margin-right: 10px; color: #ff6b6b;"></i> spprtjarvis@gmail.com</p>
                    <div style="display: flex; gap: 15px; margin-top: 20px;">
                        <a href="#" style="color: white; font-size: 20px;"><i class="fab fa-facebook"></i></a>
                        <a href="#" style="color: white; font-size: 20px;"><i class="fab fa-twitter"></i></a>
                        <a href="#" style="color: white; font-size: 20px;"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
            </div>
            <div
                style="border-top: 1px solid #444; padding: 20px 0; display: flex; justify-content: space-between; align-items: center;">
                <p>&copy; 2025 Jarvis E-commerce. All Rights Reserved.</p>
                <div>
                    <i class="fab fa-cc-visa" style="font-size: 24px; margin-left: 15px; color: #ddd;"></i>
                    <i class="fab fa-cc-mastercard" style="font-size: 24px; margin-left: 15px; color: #ddd;"></i>
                    <i class="fab fa-cc-paypal" style="font-size: 24px; margin-left: 15px; color: #ddd;"></i>
                </div>
            </div>
        </div>
    </footer>




    <!-- <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Get cart from localStorage or initialize empty array
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            let userAddresses = [];
            let selectedAddressId = null;

            // Format price with ₹ symbol
            function formatPrice(amount) {
                return '₹' + amount.toLocaleString('en-IN');
            }

            // Calculate order totals
            function calculateOrderTotals() {
                let subtotal = 0;
                let discount = 0;

                cart.forEach(item => {
                    subtotal += item.price * item.quantity;
                    discount += (item.originalPrice - item.price) * item.quantity;
                });

                // For demo purposes - in real app you'd calculate shipping based on method
                const shipping = subtotal > 999 ? 0 : 49;
                const tax = subtotal * 0.18; // 18% tax
                const total = subtotal + shipping + tax;

                return {
                    subtotal,
                    discount,
                    shipping,
                    tax,
                    total
                };
            }

            // Render cart items
            function renderCart() {
                const cartContainer = document.getElementById('cart-items-container');
                const itemCount = document.getElementById('item-count');
                const subtotalEl = document.getElementById('subtotal');
                const discountEl = document.getElementById('discount');
                const shippingEl = document.getElementById('shipping');
                const totalEl = document.getElementById('total');
                const cartCount = document.getElementById('cart-count');

                cartContainer.innerHTML = '';

                if (cart.length === 0) {
                    cartContainer.innerHTML = '<p>Your cart is empty</p>';
                    itemCount.textContent = '0';
                    subtotalEl.textContent = formatPrice(0);
                    discountEl.textContent = '-' + formatPrice(0);
                    shippingEl.textContent = 'FREE';
                    totalEl.textContent = formatPrice(0);
                    cartCount.textContent = '0';
                    return;
                }

                const totals = calculateOrderTotals();

                cart.forEach(item => {
                    const itemEl = document.createElement('div');
                    itemEl.className = 'cart-item';
                    itemEl.innerHTML = `
                    <img src="${item.image}" alt="${item.name}" class="cart-item-image">
                    <div class="item-details">
                        <h4>${item.name}</h4>
                        <div class="price">${formatPrice(item.price)} <span class="original-price">${item.originalPrice ? formatPrice(item.originalPrice) : ''}</span></div>
                        <div>Qty: ${item.quantity}</div>
                    </div>
                `;
                    cartContainer.appendChild(itemEl);
                });

                const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
                itemCount.textContent = totalItems;
                subtotalEl.textContent = formatPrice(totals.subtotal);
                discountEl.textContent = totals.discount > 0 ? '-' + formatPrice(totals.discount) : formatPrice(0);
                shippingEl.textContent = totals.shipping > 0 ? formatPrice(totals.shipping) : 'FREE';
                totalEl.textContent = formatPrice(totals.total);
                cartCount.textContent = totalItems;
            }

            // Load user addresses
            async function loadUserAddresses() {
                try {
                    userAddresses = await getUserAddresses();

                    if (userAddresses.length > 0) {
                        // Show address selection
                        document.getElementById('address-selection').style.display = 'block';

                        // Hide the form initially
                        document.getElementById('shipping-form').style.display = 'none';

                        // Populate address options
                        const addressOptions = document.getElementById('address-options');
                        addressOptions.innerHTML = '';

                        userAddresses.forEach(address => {
                            const addressOption = document.createElement('div');
                            addressOption.className = 'address-option';
                            addressOption.dataset.id = address.id;

                            addressOption.innerHTML = `
                                <h4>
                                    ${address.name}
                                    ${address.isDefault ? '<span class="default-badge">Default</span>' : ''}
                                </h4>
                                <p>${address.street}, ${address.city}, ${address.state} ${address.zipCode}</p>
                                <p>${address.country}</p>
                                <p>Phone: ${address.phone}</p>
                            `;

                            addressOption.addEventListener('click', () => {
                                // Remove selected class from all options
                                document.querySelectorAll('.address-option').forEach(opt => {
                                    opt.classList.remove('selected');
                                });

                                // Add selected class to clicked option
                                addressOption.classList.add('selected');
                                selectedAddressId = address.id;

                                // Auto-fill the form with selected address
                                fillFormWithAddress(address);
                            });

                            addressOptions.appendChild(addressOption);

                            // Select the default address
                            if (address.isDefault) {
                                addressOption.click();
                            }
                        });
                    }
                } catch (error) {
                    console.error('Error loading addresses:', error);
                }
            }

            // Fill form with address data
            function fillFormWithAddress(address) {
                const names = address.name.split(' ');
                document.getElementById('first-name').value = names[0] || '';
                document.getElementById('last-name').value = names.slice(1).join(' ') || '';
                document.getElementById('email').value = address.email || '';
                document.getElementById('phone').value = address.phone || '';
                document.getElementById('address').value = address.street || '';
                document.getElementById('city').value = address.city || '';
                document.getElementById('state').value = address.state || '';
                document.getElementById('zip').value = address.zipCode || '';
                document.getElementById('country').value = address.country || 'IN';
            }

            // Use new address button
            document.getElementById('use-new-address').addEventListener('click', () => {
                document.getElementById('shipping-form').style.display = 'block';
                document.getElementById('shipping-form').reset();
                selectedAddressId = null;

                // Remove selection from address options
                document.querySelectorAll('.address-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
            });

            // Initialize cart display
            renderCart();
            loadUserAddresses();

            // Payment method selection
            const paymentMethods = document.querySelectorAll('input[name="payment"]');

            paymentMethods.forEach(method => {
                method.addEventListener('change', function () {
                    // Hide all payment content divs
                    document.querySelectorAll('[name="payment"] ~ div').forEach(div => {
                        div.style.maxHeight = '0';
                        div.style.padding = '0 15px';
                    });

                    // Show selected payment content
                    if (this.checked) {
                        const content = this.nextElementSibling.nextElementSibling;
                        content.style.maxHeight = '500px';
                        content.style.padding = '15px';
                    }
                });
            });

            // Initialize first payment method as open
            document.querySelector('#credit-card ~ div').style.maxHeight = '500px';
            document.querySelector('#credit-card ~ div').style.padding = '15px';

            // Get estimated delivery date
            function getEstimatedDeliveryDate() {
                const deliveryDays = 5; // Standard delivery in 5 days
                const deliveryDate = new Date();
                deliveryDate.setDate(deliveryDate.getDate() + deliveryDays);
                return deliveryDate.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            }

            // Process order and save to Firebase
            async function processOrder() {
                // Validate form
                const form = document.getElementById('shipping-form');
                const inputs = form.querySelectorAll('input[required], select[required]');
                let isValid = true;

                inputs.forEach(input => {
                    if (!input.value) {
                        input.style.borderColor = '#ff6b6b';
                        isValid = false;
                    } else {
                        input.style.borderColor = '#ddd';
                    }
                });

                if (!isValid) {
                    alert('Please fill all required fields');
                    return false;
                }

                if (cart.length === 0) {
                    alert('Your cart is empty');
                    return false;
                }

                const totals = calculateOrderTotals();
                const paymentMethod = document.querySelector('input[name="payment"]:checked').id;

                // Create address object
                const addressData = {
                    firstName: document.getElementById('first-name').value,
                    lastName: document.getElementById('last-name').value,
                    email: document.getElementById('email').value,
                    phone: document.getElementById('phone').value,
                    address: document.getElementById('address').value,
                    city: document.getElementById('city').value,
                    state: document.getElementById('state').value,
                    zipCode: document.getElementById('zip').value,
                    country: document.getElementById('country').value,
                    isDefault: false
                };

                // Create order data
                const orderData = {
                    id: 'JV' + Math.floor(100000 + Math.random() * 900000), // 6-digit order ID
                    status: paymentMethod === 'cod' ? 'Pending' : 'Processing',
                    orderDate: new Date(),
                    customer: {
                        name: document.getElementById('first-name').value + ' ' + document.getElementById('last-name').value,
                        email: document.getElementById('email').value,
                        phone: document.getElementById('phone').value
                    },
                    shipping: {
                        address: addressData,
                        method: 'Standard Delivery',
                        cost: totals.shipping,
                        estimatedDelivery: getEstimatedDeliveryDate()
                    },
                    payment: {
                        method: document.querySelector('input[name="payment"]:checked').nextElementSibling.textContent.trim(),
                        status: paymentMethod === 'cod' ? 'Pending' : 'Paid',
                        amount: totals.total
                    },
                    items: JSON.parse(JSON.stringify(cart)), // Deep copy of cart items
                    subtotal: totals.subtotal,
                    tax: totals.tax,
                    discount: totals.discount,
                    totalAmount: totals.total,
                    statusHistory: [
                        {
                            title: "Order Placed",
                            status: "Completed",
                            message: "Your order has been received",
                            time: new Date().toLocaleString(),
                            additionalInfo: ""
                        }
                    ]
                };

                // Add processing status if not COD
                if (paymentMethod !== 'cod') {
                    orderData.statusHistory.push({
                        title: "Payment Processed",
                        status: "Completed",
                        message: "Your payment has been successfully processed",
                        time: new Date().toLocaleString(),
                        additionalInfo: ""
                    });
                }

                try {
                    // Save address to user's address book if it's a new address
                    if (!selectedAddressId) {
                        await saveUserAddress(addressData);
                    }

                    // Save order to history
                    const orderId = await saveOrderHistory(orderData);

                    if (orderId) {
                        // Save to localStorage for immediate access
                        localStorage.setItem('recentOrder', JSON.stringify({ ...orderData, firebaseId: orderId }));
                        localStorage.removeItem('cart'); // Clear the cart

                        return { ...orderData, firebaseId: orderId };
                    } else {
                        alert('Failed to save order. Please try again.');
                        return false;
                    }
                } catch (error) {
                    console.error('Error during checkout:', error);
                    alert('An error occurred during checkout. Please try again.');
                    return false;
                }
            }

            // Place order button
            document.getElementById('place-order').addEventListener('click', async function () {
                // Show loading state
                this.disabled = true;
                this.textContent = 'Processing...';

                const orderData = await processOrder();
                if (orderData) {
                    // Redirect to confirmation page with order ID
                    window.location.href = 'order-confirmation.html?id=' + orderData.firebaseId;
                } else {
                    // Reset button if failed
                    this.disabled = false;
                    this.textContent = 'Place Order';
                }
            });
        });
    </script> -->












    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Get cart from localStorage or initialize empty array
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            let userAddresses = [];
            let selectedAddressId = null;

            // Format price with ₹ symbol
            function formatPrice(amount) {
                return '₹' + amount.toLocaleString('en-IN');
            }

            // Calculate order totals
            function calculateOrderTotals() {
                let subtotal = 0;
                let discount = 0;

                cart.forEach(item => {
                    subtotal += item.price * item.quantity;
                    discount += (item.originalPrice - item.price) * item.quantity;
                });

                // For demo purposes - in real app you'd calculate shipping based on method
                const shipping = subtotal > 999 ? 0 : 49;
                const tax = subtotal * 0.18; // 18% tax
                const total = subtotal + shipping + tax;

                return {
                    subtotal,
                    discount,
                    shipping,
                    tax,
                    total
                };
            }

            // Render cart items
            function renderCart() {
                const cartContainer = document.getElementById('cart-items-container');
                const itemCount = document.getElementById('item-count');
                const subtotalEl = document.getElementById('subtotal');
                const discountEl = document.getElementById('discount');
                const shippingEl = document.getElementById('shipping');
                const totalEl = document.getElementById('total');
                const cartCount = document.getElementById('cart-count');

                cartContainer.innerHTML = '';

                if (cart.length === 0) {
                    cartContainer.innerHTML = '<p>Your cart is empty</p>';
                    itemCount.textContent = '0';
                    subtotalEl.textContent = formatPrice(0);
                    discountEl.textContent = '-' + formatPrice(0);
                    shippingEl.textContent = 'FREE';
                    totalEl.textContent = formatPrice(0);
                    cartCount.textContent = '0';
                    return;
                }

                const totals = calculateOrderTotals();

                cart.forEach(item => {
                    const itemEl = document.createElement('div');
                    itemEl.className = 'cart-item';
                    itemEl.innerHTML = `
                    <img src="${item.image}" alt="${item.name}" class="cart-item-image">
                    <div class="item-details">
                        <h4>${item.name}</h4>
                        <div class="price">${formatPrice(item.price)} <span class="original-price">${item.originalPrice ? formatPrice(item.originalPrice) : ''}</span></div>
                        <div>Qty: ${item.quantity}</div>
                    </div>
                `;
                    cartContainer.appendChild(itemEl);
                });

                const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
                itemCount.textContent = totalItems;
                subtotalEl.textContent = formatPrice(totals.subtotal);
                discountEl.textContent = totals.discount > 0 ? '-' + formatPrice(totals.discount) : formatPrice(0);
                shippingEl.textContent = totals.shipping > 0 ? formatPrice(totals.shipping) : 'FREE';
                totalEl.textContent = formatPrice(totals.total);
                cartCount.textContent = totalItems;
            }

            // Load user addresses
            async function loadUserAddresses() {
                try {
                    userAddresses = await getUserAddresses();

                    if (userAddresses.length > 0) {
                        // Show address selection
                        document.getElementById('address-selection').style.display = 'block';

                        // Hide the form initially
                        document.getElementById('shipping-form').style.display = 'none';

                        // Populate address options
                        const addressOptions = document.getElementById('address-options');
                        addressOptions.innerHTML = '';

                        userAddresses.forEach(address => {
                            const addressOption = document.createElement('div');
                            addressOption.className = 'address-option';
                            addressOption.dataset.id = address.id;

                            addressOption.innerHTML = `
                                <h4>
                                    ${address.name}
                                    ${address.isDefault ? '<span class="default-badge">Default</span>' : ''}
                                </h4>
                                <p>${address.street}, ${address.city}, ${address.state} ${address.zipCode}</p>
                                <p>${address.country}</p>
                                <p>Phone: ${address.phone}</p>
                            `;

                            addressOption.addEventListener('click', () => {
                                // Remove selected class from all options
                                document.querySelectorAll('.address-option').forEach(opt => {
                                    opt.classList.remove('selected');
                                });

                                // Add selected class to clicked option
                                addressOption.classList.add('selected');
                                selectedAddressId = address.id;

                                // Auto-fill the form with selected address
                                fillFormWithAddress(address);
                            });

                            addressOptions.appendChild(addressOption);

                            // Select the default address
                            if (address.isDefault) {
                                addressOption.click();
                            }
                        });
                    }
                } catch (error) {
                    console.error('Error loading addresses:', error);
                }
            }

            // Fill form with address data
            function fillFormWithAddress(address) {
                const names = address.name.split(' ');
                document.getElementById('first-name').value = names[0] || '';
                document.getElementById('last-name').value = names.slice(1).join(' ') || '';
                document.getElementById('email').value = address.email || '';
                document.getElementById('phone').value = address.phone || '';
                document.getElementById('address').value = address.street || '';
                document.getElementById('city').value = address.city || '';
                document.getElementById('state').value = address.state || '';
                document.getElementById('zip').value = address.zipCode || '';
                document.getElementById('country').value = address.country || 'IN';
            }

            // Use new address button
            document.getElementById('use-new-address').addEventListener('click', () => {
                document.getElementById('shipping-form').style.display = 'block';
                document.getElementById('shipping-form').reset();
                selectedAddressId = null;

                // Remove selection from address options
                document.querySelectorAll('.address-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
            });

            // Initialize cart display
            renderCart();
            loadUserAddresses();

            // Payment method selection
            const paymentMethods = document.querySelectorAll('input[name="payment"]');

            paymentMethods.forEach(method => {
                method.addEventListener('change', function () {
                    // Hide all payment content divs
                    document.querySelectorAll('[name="payment"] ~ div').forEach(div => {
                        div.style.maxHeight = '0';
                        div.style.padding = '0 15px';
                    });

                    // Show selected payment content
                    if (this.checked) {
                        const content = this.nextElementSibling.nextElementSibling;
                        content.style.maxHeight = '500px';
                        content.style.padding = '15px';
                    }
                });
            });

            // Initialize first payment method as open
            document.querySelector('#credit-card ~ div').style.maxHeight = '500px';
            document.querySelector('#credit-card ~ div').style.padding = '15px';

            // Get estimated delivery date
            function getEstimatedDeliveryDate() {
                const deliveryDays = 5; // Standard delivery in 5 days
                const deliveryDate = new Date();
                deliveryDate.setDate(deliveryDate.getDate() + deliveryDays);
                return deliveryDate.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            }

            // Clear cart from Firebase
            // Clear cart from Firebase - ENHANCED VERSION
            async function clearFirebaseCart() {
                try {
                    const user = auth.currentUser;
                    if (!user) {
                        console.log("User not logged in, skipping Firebase cart clear");
                        return true;
                    }

                    console.log("🔄 Starting Firebase cart clearance for user:", user.uid);
                    let successCount = 0;
                    let totalAttempts = 0;

                    // METHOD 1: Clear cart collection
                    try {
                        totalAttempts++;
                        const cartQuery = query(collection(db, "cart"), where("userId", "==", user.uid));
                        const querySnapshot = await getDocs(cartQuery);

                        console.log(`Found ${querySnapshot.size} cart items to delete`);

                        const deletePromises = [];
                        querySnapshot.forEach((doc) => {
                            deletePromises.push(deleteDoc(doc.ref));
                        });

                        if (deletePromises.length > 0) {
                            await Promise.all(deletePromises);
                            console.log(`✅ Successfully deleted ${deletePromises.length} items from cart collection`);
                            successCount++;
                        } else {
                            console.log("ℹ️ No items found in cart collection");
                            successCount++;
                        }
                    } catch (error) {
                        console.error("❌ Error clearing cart collection:", error);
                    }

                    // METHOD 2: Clear cart from user document
                    try {
                        totalAttempts++;
                        const userDocRef = doc(db, "users", user.uid);
                        await updateDoc(userDocRef, {
                            cart: [],
                            lastUpdated: new Date()
                        });
                        console.log("✅ Successfully cleared cart from user document");
                        successCount++;
                    } catch (error) {
                        console.error("❌ Error clearing cart from user document:", error);
                    }

                    // METHOD 3: Force clear using batch operation
                    try {
                        totalAttempts++;
                        // One more attempt to ensure everything is cleared
                        const finalCheck = query(collection(db, "cart"), where("userId", "==", user.uid));
                        const finalSnapshot = await getDocs(finalCheck);

                        if (finalSnapshot.size > 0) {
                            console.log(`🔄 Found ${finalSnapshot.size} remaining items, performing final cleanup`);
                            const finalDeletePromises = [];
                            finalSnapshot.forEach((doc) => {
                                finalDeletePromises.push(deleteDoc(doc.ref));
                            });
                            await Promise.all(finalDeletePromises);
                            console.log("✅ Final cleanup completed");
                        }
                        successCount++;
                    } catch (error) {
                        console.error("❌ Error in final cleanup:", error);
                    }

                    console.log(`📊 Cart clearance summary: ${successCount}/${totalAttempts} methods successful`);
                    return successCount > 0; // Return true if at least one method succeeded
                } catch (error) {
                    console.error("❌ Critical error clearing Firebase cart:", error);
                    return false;
                }
            }
            // Process order and save to Firebase
            // Process order and save to Firebase - UPDATED VERSION
            async function processOrder() {
                // Validate form
                const form = document.getElementById('shipping-form');
                const inputs = form.querySelectorAll('input[required], select[required]');
                let isValid = true;

                inputs.forEach(input => {
                    if (!input.value) {
                        input.style.borderColor = '#ff6b6b';
                        isValid = false;
                    } else {
                        input.style.borderColor = '#ddd';
                    }
                });

                if (!isValid) {
                    alert('Please fill all required fields');
                    return false;
                }

                if (cart.length === 0) {
                    alert('Your cart is empty');
                    return false;
                }

                const totals = calculateOrderTotals();
                const paymentMethod = document.querySelector('input[name="payment"]:checked').id;

                // Create address object
                const addressData = {
                    firstName: document.getElementById('first-name').value,
                    lastName: document.getElementById('last-name').value,
                    email: document.getElementById('email').value,
                    phone: document.getElementById('phone').value,
                    address: document.getElementById('address').value,
                    city: document.getElementById('city').value,
                    state: document.getElementById('state').value,
                    zipCode: document.getElementById('zip').value,
                    country: document.getElementById('country').value,
                    isDefault: false
                };

                // Create order data
                const orderData = {
                    id: 'JV' + Math.floor(100000 + Math.random() * 900000), // 6-digit order ID
                    status: paymentMethod === 'cod' ? 'Pending' : 'Processing',
                    orderDate: new Date(),
                    customer: {
                        name: document.getElementById('first-name').value + ' ' + document.getElementById('last-name').value,
                        email: document.getElementById('email').value,
                        phone: document.getElementById('phone').value
                    },
                    shipping: {
                        address: addressData,
                        method: 'Standard Delivery',
                        cost: totals.shipping,
                        estimatedDelivery: getEstimatedDeliveryDate()
                    },
                    payment: {
                        method: document.querySelector('input[name="payment"]:checked').nextElementSibling.textContent.trim(),
                        status: paymentMethod === 'cod' ? 'Pending' : 'Paid',
                        amount: totals.total
                    },
                    items: JSON.parse(JSON.stringify(cart)), // Deep copy of cart items
                    subtotal: totals.subtotal,
                    tax: totals.tax,
                    discount: totals.discount,
                    totalAmount: totals.total,
                    statusHistory: [
                        {
                            title: "Order Placed",
                            status: "Completed",
                            message: "Your order has been received",
                            time: new Date().toLocaleString(),
                            additionalInfo: ""
                        }
                    ]
                };

                // Add processing status if not COD
                if (paymentMethod !== 'cod') {
                    orderData.statusHistory.push({
                        title: "Payment Processed",
                        status: "Completed",
                        message: "Your payment has been successfully processed",
                        time: new Date().toLocaleString(),
                        additionalInfo: ""
                    });
                }

                try {
                    console.log("Starting order processing...");

                    // Save address to user's address book if it's a new address
                    if (!selectedAddressId) {
                        console.log("Saving new address...");
                        await saveUserAddress(addressData);
                    }

                    // Save order to history
                    console.log("Saving order to Firebase...");
                    const orderId = await saveOrderHistory(orderData);

                    if (orderId) {
                        console.log("Order saved successfully with ID:", orderId);
                        console.log("Starting cart clearing process...");

                        // IMPORTANT: Clear cart from Firebase and wait for completion
                        const cartCleared = await clearFirebaseCart();

                        if (cartCleared) {
                            console.log("✅ Firebase cart cleared successfully");
                        } else {
                            console.warn("⚠️ Firebase cart clearing may have issues");
                        }

                        // Set the flag to prevent cart reload on index.html
                        sessionStorage.setItem('cartJustCleared', 'true');
                        console.log("✅ Session storage flag set");

                        // Clear localStorage cart
                        localStorage.removeItem('cart');
                        console.log("✅ Local storage cart cleared");

                        // Verify cart is cleared by checking all locations
                        await verifyCartCleared();

                        // Save to localStorage for immediate access
                        localStorage.setItem('recentOrder', JSON.stringify({ ...orderData, firebaseId: orderId }));
                        console.log("✅ Recent order saved to local storage");

                        console.log("🎉 Order processing completed successfully!");
                        return { ...orderData, firebaseId: orderId };
                    } else {
                        console.error("❌ Failed to save order to Firebase");
                        alert('Failed to save order. Please try again.');
                        return false;
                    }
                } catch (error) {
                    console.error('❌ Error during checkout:', error);
                    alert('An error occurred during checkout. Please try again.');
                    return false;
                }
            }

            // Add this verification function
            async function verifyCartCleared() {
                try {
                    const user = auth.currentUser;
                    if (!user) {
                        console.log("No user logged in for verification");
                        return;
                    }

                    console.log("=== VERIFYING CART CLEARANCE ===");

                    // Check cart collection
                    const cartQuery = query(collection(db, "cart"), where("userId", "==", user.uid));
                    const querySnapshot = await getDocs(cartQuery);
                    console.log(`Cart collection items after clear: ${querySnapshot.size}`);

                    // Check user document cart
                    const userDoc = await getDoc(doc(db, "users", user.uid));
                    if (userDoc.exists()) {
                        const userData = userDoc.data();
                        const userCart = userData.cart || [];
                        console.log(`User document cart items after clear: ${userCart.length}`);
                    }

                    console.log("Local storage cart after clear:", JSON.parse(localStorage.getItem('cart')) || []);
                    console.log("Session storage flag:", sessionStorage.getItem('cartJustCleared'));
                    console.log("=== VERIFICATION COMPLETE ===");
                } catch (error) {
                    console.error("Verification error:", error);
                }
            }


            // Place order button - ENHANCED VERSION
            document.getElementById('place-order').addEventListener('click', async function () {
                // Show loading state
                const originalText = this.textContent;
                this.disabled = true;
                this.textContent = 'Processing Order...';
                this.style.backgroundColor = '#ccc';

                try {
                    console.log("🔄 Starting order placement process...");
                    const orderData = await processOrder();

                    if (orderData) {
                        console.log("✅ Order processed successfully, redirecting...");
                        // Redirect to confirmation page with order ID
                        window.location.href = 'order-confirmation.html?id=' + orderData.firebaseId;
                    } else {
                        console.error("❌ Order processing failed");
                        // Reset button if failed
                        this.disabled = false;
                        this.textContent = originalText;
                        this.style.backgroundColor = '';
                        alert('Order processing failed. Please try again.');
                    }
                } catch (error) {
                    console.error("❌ Unexpected error:", error);
                    // Reset button if error
                    this.disabled = false;
                    this.textContent = originalText;
                    this.style.backgroundColor = '';
                    alert('An unexpected error occurred. Please try again.');
                }
            });
        });









        // Debug function to check current cart state
        async function debugCartState() {
            try {
                const user = auth.currentUser;
                if (!user) {
                    console.log("No user logged in for debug");
                    return;
                }

                console.log("=== DEBUG CART STATE ===");

                // Check cart collection
                const cartQuery = query(collection(db, "cart"), where("userId", "==", user.uid));
                const querySnapshot = await getDocs(cartQuery);
                console.log(`Cart collection items: ${querySnapshot.size}`);

                // Check user document cart
                const userDoc = await getDoc(doc(db, "users", user.uid));
                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    const userCart = userData.cart || [];
                    console.log(`User document cart items: ${userCart.length}`);
                }

                console.log("Local storage cart:", JSON.parse(localStorage.getItem('cart')) || []);
                console.log("Session storage flag:", sessionStorage.getItem('cartJustCleared'));
                console.log("=== END DEBUG ===");
            } catch (error) {
                console.error("Debug error:", error);
            }
        }

        // Call this before and after order processing to verify
        // await debugCartState();

    </script>
</body>

</html>